---
phase: 03-ai-powered-cms
plan: 03
type: execute
wave: 3
depends_on: ["03-02"]
files_modified:
  - src/contexts/edit-mode-context.tsx
  - src/components/admin/edit-mode-toggle.tsx
  - src/components/editable/editable-text.tsx
  - src/components/editable/editable-image.tsx
  - src/lib/actions/inline-content.ts
  - src/app/admin/layout.tsx
  - src/components/sections/hero-section.tsx
  - src/components/sections/program-card.tsx
  - src/app/(public)/layout.tsx
  - supabase/migrations/003_images.sql
autonomous: true

must_haves:
  truths:
    - "Admin sees Edit Mode toggle in admin navigation"
    - "When Edit Mode is on, editable text shows hover highlight"
    - "Clicking editable text opens inline editor"
    - "Saving inline edit updates database immediately"
    - "When Edit Mode is on, images show upload overlay on hover"
    - "Clicking image opens file picker for new upload"
    - "Uploaded images are stored in Supabase Storage"
    - "New image URL is saved to database and displays immediately"
  artifacts:
    - path: "src/contexts/edit-mode-context.tsx"
      provides: "React context for edit mode state"
      exports: ["EditModeProvider", "useEditMode"]
    - path: "src/components/editable/editable-text.tsx"
      provides: "Inline text editing component"
      min_lines: 60
    - path: "src/components/editable/editable-image.tsx"
      provides: "Image upload/swap component"
      min_lines: 80
    - path: "src/lib/actions/inline-content.ts"
      provides: "Server actions for inline saves"
      exports: ["saveInlineText", "saveInlineImage"]
---

<objective>
Build inline editing system for text and images

Purpose: Allow admins to click directly on content to edit it, making content management more intuitive than chat-only interface. Support both text editing and image swapping across all site images.

Output:
- Edit Mode toggle in admin panel
- Editable text wrapper with inline editing
- Editable image wrapper with upload overlay
- Server actions for immediate saves
- Image storage in Supabase Storage
- All current text and images wrapped with editable components
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task id="1" name="Edit mode context and toggle" commit_type="feat">
Create edit mode infrastructure:

1. Create `src/contexts/edit-mode-context.tsx`:
   - EditModeContext with isEditMode state
   - EditModeProvider component
   - useEditMode hook
   - Only enable for authenticated admin users

2. Create `src/components/admin/edit-mode-toggle.tsx`:
   - Toggle button/switch component
   - Shows "Edit Mode: ON/OFF" status
   - Keyboard shortcut (Cmd/Ctrl + E)

3. Update `src/app/admin/layout.tsx`:
   - Wrap with EditModeProvider
   - Add EditModeToggle to header/nav

4. Update `src/app/(public)/layout.tsx`:
   - Wrap with EditModeProvider (for admin viewing public pages in edit mode)
   - Check auth status to conditionally enable

Acceptance: Toggle appears in admin nav, state persists across page navigation
</task>

<task id="2" name="Editable text component" commit_type="feat">
Create inline text editing:

1. Create `src/components/editable/editable-text.tsx`:
   ```tsx
   interface EditableTextProps {
     contentKey: string;
     children: React.ReactNode;
     className?: string;
     as?: 'span' | 'p' | 'h1' | 'h2' | 'h3';
   }
   ```

   Behavior:
   - When edit mode OFF: render children normally
   - When edit mode ON: show dashed border on hover
   - On click: switch to contenteditable or input
   - On blur/Enter: save to database via server action
   - Show saving indicator
   - Optimistic update

2. Create `src/lib/actions/inline-content.ts`:
   - `saveInlineText(contentKey: string, text: string)` server action
   - Revalidate path after save

3. Update hero section to use EditableText:
   - Wrap headline with EditableText
   - Wrap subtitle with EditableText

Acceptance: Can click and edit hero text, saves to database
</task>

<task id="3" name="Editable image component with upload" commit_type="feat">
Create image swapping with upload:

1. Create migration `supabase/migrations/003_images.sql`:
   - Add image records to site_content table
   - Add entries for hero image, program images, etc.

2. Create `src/components/editable/editable-image.tsx`:
   ```tsx
   interface EditableImageProps {
     contentKey: string;
     src: string;
     alt: string;
     className?: string;
     width?: number;
     height?: number;
   }
   ```

   Behavior:
   - When edit mode OFF: render Next.js Image normally
   - When edit mode ON: show camera/upload icon overlay on hover
   - On click: open hidden file input
   - On file select: upload to Supabase Storage
   - Save new URL to database
   - Show upload progress
   - Update image immediately

3. Add server action `saveInlineImage(contentKey: string, imageUrl: string)` to inline-content.ts

4. Create Supabase Storage bucket for site images (document in README)

Acceptance: Can click image, select new file, see it upload and replace
</task>

<task id="4" name="Wrap all site content with editable components" commit_type="feat">
Apply editable wrappers across the site:

1. Hero section:
   - EditableText for headline, subtitle, CTA buttons
   - EditableImage for hero background/poster

2. Program cards:
   - EditableImage for program images
   - EditableText for titles and descriptions (if from database)

3. Other pages as applicable:
   - About page content
   - Any other text/images that should be editable

4. Add content keys to database for all editable content

5. Update queries.ts to fetch image content

Acceptance: All major text and images are editable in edit mode
</task>

</tasks>

<validation>
After completing all tasks:
1. Log in as admin
2. Toggle Edit Mode ON
3. Navigate to homepage
4. Click on hero headline - should become editable
5. Change text and click away - should save
6. Hover over hero image - should show upload overlay
7. Click and select new image - should upload and display
8. Toggle Edit Mode OFF - all edit UI should disappear
9. Refresh page - changes should persist
</validation>
