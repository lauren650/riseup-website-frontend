---
phase: 02-interactive-features
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - supabase/migrations/001_sponsors.sql
  - src/lib/validations/sponsor.ts
  - src/lib/actions/sponsors.ts
  - src/components/sponsors/logo-upload.tsx
  - src/components/sponsors/sponsor-form.tsx
  - src/app/(public)/partners/page.tsx
autonomous: true
user_setup:
  - service: supabase
    why: "Database schema and storage bucket for sponsor data/logos"
    dashboard_config:
      - task: "Create 'sponsor-logos' storage bucket"
        location: "Supabase Dashboard -> Storage -> Create new bucket -> Name: sponsor-logos, Public: Yes"
      - task: "Run migrations (if not using Supabase CLI)"
        location: "Supabase Dashboard -> SQL Editor -> Run contents of supabase/migrations/001_sponsors.sql"

must_haves:
  truths:
    - "Sponsor can submit form with company info and logo"
    - "Logo is uploaded to Supabase Storage"
    - "Form validates all required fields before submission"
    - "Sponsor receives confirmation email after submission"
    - "Admin receives notification email about new submission"
  artifacts:
    - path: "supabase/migrations/001_sponsors.sql"
      provides: "Sponsors table schema with RLS policies"
      contains: "CREATE TABLE sponsors"
    - path: "src/lib/validations/sponsor.ts"
      provides: "Zod schema for sponsor form validation"
      exports: ["sponsorSchema", "SponsorFormData"]
    - path: "src/lib/actions/sponsors.ts"
      provides: "Server action for sponsor submission"
      exports: ["submitSponsor"]
    - path: "src/components/sponsors/logo-upload.tsx"
      provides: "Client-side logo upload component"
      exports: ["LogoUpload"]
    - path: "src/components/sponsors/sponsor-form.tsx"
      provides: "Complete sponsor submission form"
      exports: ["SponsorForm"]
    - path: "src/app/(public)/partners/page.tsx"
      provides: "Partners page with sponsor form and dynamic grid"
      contains: "SponsorForm"
  key_links:
    - from: "src/components/sponsors/sponsor-form.tsx"
      to: "src/lib/actions/sponsors.ts"
      via: "server action submission"
      pattern: "submitSponsor"
    - from: "src/components/sponsors/sponsor-form.tsx"
      to: "src/components/sponsors/logo-upload.tsx"
      via: "component composition"
      pattern: "LogoUpload"
    - from: "src/lib/actions/sponsors.ts"
      to: "supabase.from('sponsors')"
      via: "database insert"
      pattern: "supabase.*from.*sponsors.*insert"
---

<objective>
Build sponsor submission infrastructure: database schema, file upload, validation, form, and email notifications.

Purpose: Enable pre-approved sponsors to self-submit their company information and logo through a self-service portal. This fulfills requirements SPON-01 (submission form), SPON-02 (logo validation), and SPON-03 (admin notification).

Output: Complete sponsor submission flow from form to database to email notifications.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-interactive-features/02-RESEARCH.md
@.planning/phases/02-interactive-features/02-CONTEXT.md

Existing patterns to follow:
@src/lib/validations/contact.ts (Zod schema pattern)
@src/lib/actions/contact.ts (server action with Resend email pattern)
@src/components/sections/contact-form.tsx (react-hook-form pattern)
@src/lib/supabase/client.ts (client-side Supabase)
@src/lib/supabase/server.ts (server-side Supabase)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create database schema and storage setup</name>
  <files>supabase/migrations/001_sponsors.sql</files>
  <action>
Create the Supabase migration file for sponsors:

1. Create supabase/migrations directory if it doesn't exist
2. Create 001_sponsors.sql with:
   - sponsors table: id (UUID), company_name, contact_name, contact_email, contact_phone, website_url, description (optional), logo_url, status ('pending'|'approved'), created_at, updated_at, approved_at (nullable), approved_by (nullable UUID ref to auth.users)
   - Enable RLS on sponsors table
   - Policy: Anyone can INSERT with status='pending'
   - Policy: Anyone can SELECT where status='approved'
   - Policy: Authenticated users can SELECT all and UPDATE
   - Indexes on status and company_name

3. Add storage RLS policies in the same migration:
   - Allow anyone to INSERT into sponsor-logos bucket with path starting with 'pending/'
   - Allow authenticated users to INSERT into 'approved/' path
   - Allow anyone to SELECT (read) from sponsor-logos bucket

Follow the schema from RESEARCH.md "Supabase Database Schema" section.
  </action>
  <verify>
SQL file exists and has valid syntax. Can be validated by running in Supabase SQL editor or with a SQL linter.
  </verify>
  <done>
Migration file created with sponsors table, RLS policies for table and storage, and appropriate indexes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create validation schema and server action</name>
  <files>src/lib/validations/sponsor.ts, src/lib/actions/sponsors.ts</files>
  <action>
Create Zod validation and server action following existing contact form patterns:

1. src/lib/validations/sponsor.ts:
   - Define sponsorSchema with: companyName (min 2), contactName (min 2), contactEmail (email), contactPhone (min 10), websiteUrl (url), description (max 500, optional)
   - Note: logo validation happens client-side in LogoUpload component, not in Zod schema (file already uploaded by submission time)
   - Export SponsorFormData type

2. src/lib/actions/sponsors.ts:
   - Create submitSponsor server action following contact.ts pattern
   - Accept FormData with logoUrl (already uploaded by client)
   - Validate with Zod
   - Insert into sponsors table with status='pending'
   - Send confirmation email to sponsor via Resend
   - Send notification email to admin (ADMIN_EMAIL env var) via Resend
   - Return { success, message, errors? }

Follow patterns from contact.ts for error handling and email sending.
  </action>
  <verify>
TypeScript compiles: `npm run build` succeeds with no errors in sponsor.ts or sponsors.ts
  </verify>
  <done>
Validation schema exports sponsorSchema and SponsorFormData. Server action handles form submission, database insert, and both email notifications.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create logo upload and sponsor form components</name>
  <files>src/components/sponsors/logo-upload.tsx, src/components/sponsors/sponsor-form.tsx</files>
  <action>
Create the UI components:

1. src/components/sponsors/logo-upload.tsx:
   - Client component for uploading logo to Supabase Storage
   - Accept file types: PNG, JPG, SVG, WebP
   - Max size: 5MB
   - Upload to sponsor-logos bucket in 'pending/' folder
   - Show upload progress/status
   - Call onUploadComplete(url) when done
   - Show preview of uploaded image
   - Match existing form styling (dark theme, border-white/10)

2. src/components/sponsors/sponsor-form.tsx:
   - Follow contact-form.tsx pattern exactly:
     - use react-hook-form with zodResolver
     - use useActionState for server action submission
   - Fields: Company Name, Contact Name, Email, Phone, Website URL, Description (textarea), Logo (LogoUpload component)
   - Store uploaded logo URL in hidden input or state
   - Prevent submission until logo is uploaded
   - Show success/error messages
   - Reset form on success

Use same inputClassName styling as contact-form.tsx for consistency.
  </action>
  <verify>
1. TypeScript compiles: `npm run build` succeeds
2. Components render without errors in browser
  </verify>
  <done>
LogoUpload component handles file upload to Supabase Storage. SponsorForm component renders complete form with validation and submission handling.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` succeeds without errors
2. `npm run dev` - form renders on partners page (after page update in 02-03)
3. Migration file ready to apply to Supabase
4. All TypeScript types compile correctly
</verification>

<success_criteria>
- Migration file creates sponsors table with proper RLS
- Zod schema validates all sponsor fields
- Server action inserts to database and sends emails
- LogoUpload component uploads to Supabase Storage
- SponsorForm component provides complete submission UI
- All code follows existing codebase patterns
</success_criteria>

<output>
After completion, create `.planning/phases/02-interactive-features/02-02-SUMMARY.md`
</output>
