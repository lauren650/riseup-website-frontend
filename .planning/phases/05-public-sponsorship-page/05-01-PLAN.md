---
phase: 05-public-sponsorship-page
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - supabase/migrations/006_package_display.sql
  - src/lib/supabase/types.ts
  - src/lib/validations/sponsor-interest.ts
  - src/lib/actions/sponsor-interest.ts
autonomous: true

must_haves:
  truths:
    - "Sponsorship packages have description and benefits data available"
    - "Interest form data can be validated with type safety"
    - "Form submission sends confirmation email to prospect"
    - "Form submission sends notification email to admin"
  artifacts:
    - path: "supabase/migrations/006_package_display.sql"
      provides: "Schema extension for package display fields"
      contains: "ALTER TABLE sponsorship_packages ADD COLUMN"
    - path: "src/lib/supabase/types.ts"
      provides: "TypeScript types for extended package schema"
      contains: "description"
    - path: "src/lib/validations/sponsor-interest.ts"
      provides: "Zod validation schema for interest form"
      exports: ["sponsorInterestSchema", "SponsorInterestFormData"]
    - path: "src/lib/actions/sponsor-interest.ts"
      provides: "Server action for interest form submission"
      exports: ["submitSponsorInterest", "SponsorInterestFormState"]
  key_links:
    - from: "src/lib/actions/sponsor-interest.ts"
      to: "src/lib/validations/sponsor-interest.ts"
      via: "import validation schema"
      pattern: "import.*sponsorInterestSchema.*from.*validations"
    - from: "src/lib/actions/sponsor-interest.ts"
      to: "resend"
      via: "dual email send"
      pattern: "resend\\.emails\\.send"
---

<objective>
Create database schema extension and server-side form handling for sponsor interest submissions

Purpose: Enable the public sponsorship page to display package benefits and handle interest form submissions with email notifications
Output: Migration file, TypeScript types, validation schema, and server action ready for UI consumption
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-public-sponsorship-page/05-CONTEXT.md
@.planning/phases/05-public-sponsorship-page/05-RESEARCH.md
@.planning/phases/04-foundation-schema/04-01-SUMMARY.md

# Existing patterns to follow
@src/lib/validations/sponsor.ts
@src/lib/validations/contact.ts
@src/lib/actions/sponsors.ts
@src/lib/actions/contact.ts
@supabase/migrations/005_invoicing.sql
@src/lib/supabase/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create schema migration for package display fields</name>
  <files>supabase/migrations/006_package_display.sql, src/lib/supabase/types.ts</files>
  <action>
Create migration `supabase/migrations/006_package_display.sql` that adds display fields to sponsorship_packages:

1. Add columns to sponsorship_packages table:
   - `description TEXT` - Short tagline/description for pricing table
   - `benefits TEXT[]` - Array of benefit strings for checklist display

2. Update existing seed data with descriptions and benefits:
   - T-shirt package ($3500): "Premium visibility across all programs"
     Benefits: ["Logo on tackle & flag t-shirts", "Website logo placement", "Banner at all games", "Golf tournament sign"]
   - Website only ($600): "Digital presence for your brand"
     Benefits: ["Logo on website sponsors section", "Link to your website"]
   - Game day package ($750): "Game day brand exposure"
     Benefits: ["Banner display at games", "PA announcements", "Social media mentions"]
   - Academy t-shirt ($500): "Support youth development"
     Benefits: ["Logo on Rise Up Academy t-shirts", "Certificate of appreciation"]

3. Update TypeScript types in `src/lib/supabase/types.ts`:
   - Add `description: string | null` to SponsorshipPackage interface
   - Add `benefits: string[] | null` to SponsorshipPackage interface

Follow the migration pattern from 005_invoicing.sql (header comments, clear sections).
  </action>
  <verify>
- File exists at supabase/migrations/006_package_display.sql
- Migration adds description and benefits columns
- TypeScript types updated with new fields
- `npm run build` passes (type checking)
  </verify>
  <done>
- sponsorship_packages schema extended with description (TEXT) and benefits (TEXT[]) columns
- Existing packages updated with display content
- TypeScript types reflect new schema
  </done>
</task>

<task type="auto">
  <name>Task 2: Create validation schema and server action for interest form</name>
  <files>src/lib/validations/sponsor-interest.ts, src/lib/actions/sponsor-interest.ts</files>
  <action>
Create validation schema at `src/lib/validations/sponsor-interest.ts`:

```typescript
import { z } from "zod";

export const sponsorInterestSchema = z.object({
  name: z.string().min(2, "Name must be at least 2 characters"),
  email: z.string().email("Please enter a valid email"),
  phone: z.string().min(10, "Phone number must be at least 10 digits"),
  companyName: z.string().min(2, "Company name must be at least 2 characters"),
  recaptchaToken: z.string().optional(),
});

export type SponsorInterestFormData = z.infer<typeof sponsorInterestSchema>;
```

Create server action at `src/lib/actions/sponsor-interest.ts`:

1. Export interface `SponsorInterestFormState` with:
   - success: boolean
   - message: string
   - errors?: { name?: string[], email?: string[], phone?: string[], companyName?: string[] }

2. Export async function `submitSponsorInterest(prevState, formData)`:
   - Parse form data into SponsorInterestFormData shape
   - Validate with sponsorInterestSchema.safeParse()
   - On validation failure: return error state with field errors
   - Verify reCAPTCHA token using fetch to Google's siteverify API (copy pattern from contact.ts)
   - On reCAPTCHA failure: return error state (but don't block if RECAPTCHA_SECRET_KEY not set)
   - Send confirmation email to prospect:
     - From: "RiseUp Website <onboarding@resend.dev>"
     - Subject: "Sponsor Interest Received - RiseUp Youth Football"
     - Body: Thank them, confirm receipt, mention "2-3 business days" response time
   - Send notification email to admin (ADMIN_EMAIL or CONTACT_EMAIL env var):
     - From: "RiseUp Website <onboarding@resend.dev>"
     - Subject: "New Sponsor Interest: {companyName}"
     - Body: All form fields with mailto link for email, replyTo set to prospect's email
   - Return success state with message

Follow exact patterns from `src/lib/actions/sponsors.ts` for:
- Resend initialization with env check
- Error handling (don't fail submission if email fails)
- Admin email fallback chain
  </action>
  <verify>
- Files exist at specified paths
- `npm run build` passes
- Validation schema exports sponsorInterestSchema and SponsorInterestFormData
- Server action exports submitSponsorInterest and SponsorInterestFormState
  </verify>
  <done>
- Zod schema validates name, email, phone, companyName with appropriate rules
- Server action handles form submission with validation and dual email sending
- reCAPTCHA verification integrated (graceful degradation if not configured)
- Email templates match site tone
  </done>
</task>

</tasks>

<verification>
1. Both migration and server action files exist
2. `npm run build` passes without type errors
3. TypeScript types include new description/benefits fields
4. Server action follows established dual-email pattern
</verification>

<success_criteria>
- [ ] Migration file ready to apply (006_package_display.sql)
- [ ] TypeScript types updated for extended schema
- [ ] Validation schema ready for form component
- [ ] Server action ready for useActionState consumption
- [ ] All patterns match existing codebase conventions
</success_criteria>

<output>
After completion, create `.planning/phases/05-public-sponsorship-page/05-01-SUMMARY.md`
</output>
